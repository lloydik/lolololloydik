# Reverse tasks

## Очень странные кодировки

### Условие

> На море на океане есть остров, на том острове дуб стоит, под дубом сундук зарыт, в сундуке — заяц, в зайце — утка, в утке — петух, в петухе — пробел, в пробеле — флаг. Стоп, что-то в этой сказке не так

[Файл](files/strange_codes/task.bf.zip)

### Решение

Получив файл и распаковав его, мы обращаем внимание на расширение файла. Это расширение файла языка brainfuck. Надо найти [онлайн-компилятор](https://www.dcode.fr/brainfuck-language) для этого языка. После того, как мы выполнили код мы види строчку вида `KoKoKoKoKoKoKoKoKoKo Kud Kudah KoKo Kudah KoKoKo kudah kudah kO kud KoKoKoKoKoKoKoKoKoKo Kudah...` Скорее всего это ещё один эзотерический язык программирования. Гуглим его и натыкаемся на язык PETOOH. Ищем под него [онлайн-компилятор](https://ky6uk.github.io/PETOOH/). После выполнения кода ничего не появилось. Или всё же появилось? Если выделить область, в которой должно было появиться сообщение, то мы можем увидеть whitespace'ы. Гуглим язык программирования whitespaces и ищем [онлайн-компилятор](https://www.dcode.fr/whitespace-language). Компилируем программу и получаем флаг

### Флаг 

**MSHP{PoNy_r3verse_f0r_CTFReady}**

## Strace

### Условие

> В данном таске вам необходимо разобраться в выводе утилиты strace - она показывает системные вызовы в бинаре.
> 
> [Вывод](https://gist.github.com/greg0r0/af5d46605f0cc7af7f10b0f08c740687)

### Условие
В данном таске вам необходимо разобраться в выводе утилиты strace - она показывает системные вызовы в бинаре.

[Вывод](https://gist.github.com/greg0r0/af5d46605f0cc7af7f10b0f08c740687)

### Решение 
- Заметим на https://gist.github.com/greg0r0/af5d46605f0cc7af7f10b0f08c740687 какой-то вывод после использования команды *strace*
- Если посмотрим начало представленного файла, то заметим, что вызывались nmap и другие команды(здесь должен быть скрин первой части файла до 29 строки)
- На строчке 30 открывается файлик в который записывается какая-то информация, с помощью write. Если попробуем скопировать строки 31-56, и вставим в cyberchef так, чтобы осталась только та информация, которая записывается в файл, и преобразуем из 16-ой системы счисления. ([рецепт в cyberchef](https://gchq.github.io/CyberChef/#recipe=Fork(',%201)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%201','',false)) 5263855cd5efccc3ff50d7797428931be69fed7a

### Флаг

**mshp{t00_m4ny_wr1t3_c4lls}**

## Деобфусцируй

### Условие

> Мы тут код на питоне нашли, легаси. Но он в каком-то очень странном формате. Сможешь разобраться в нем?
>
> Ответ обернуть в mshp{}.

[Файл](files/deobfuscation/crackme1.pyc)

### Решение

Закидываем файл в https://www.toolnb.com/tools-lang-en/pyc.html. Берм код и анализируем. Первые строчки, которые нас интересуют

```python
assert len(sys.argv) == 10
a, b, c, d, e, f, g, h, i = [ int(x) for x in sys.argv[1:] ]
```

Эти строчки берут числа, которые ввёл пользователь при запуске скрипта. Их должно быть 9. Дальше идут строки с assert'ами, но их мы посмотрим попозже

```python
codestr = ('').join(chr(x) for x in [a, b, c, d, e, f, g, h, i])
```
В этой строке собирается строка, которая будет использоваться для шифрования в будущем

```python
def xorc(a, b):
    return chr(ord(a) ^ ord(b))

def xorstr(a, b):
    return ('').join([ xorc(a[(i % len(a))], c) for i, c in enumerate(b) ])

result += xorstr(codestr, '\x0fp4$-\x064l?\x06 o!h\x17t3`\x10')
```

Здесь мы видим, что шифруется константная строка с помощью шифра XOR и ключа, который был введён пользователем. Можно сделать вывод, что нам нужно найти ключ. Теперь перейдём к строкам с assert'ами:

```python
assert b == c
assert c == g
assert g == h
assert g + b + c == 0
```
В этих четырёх строках проверяется, что сумма g, b и c равна 0, и при этом g = b = c = h. Такое может быть только при нуле, следовательно g, b, c, h равны 0 при вводе. Смотрим следующие assert'ы

```python
assert 3 * a + 12 * d + e + 4 * f + 6 * i == 2194
assert -6 * a + 2 * d - 4 * e - f + 9 * i == -243
assert a + 6 * d + 2 * e + 7 * f + 11 * i == 2307
assert 5 * a - 2 * d - 7 * e + 76 * f + 8 * i == 8238
assert 2 * a - 2 * d - 2 * e - 2 * f + 2 * i == -72
```

Можем закинуть в wolfram как систему без пробелов и заменить названия переменных (потому что e вольфрам не будет воспринимать как переменную. Такая же ситуация и с остальными. Лучше использовать в качестве переменных символы x, z, y, w и т.д.)

Решив систему, Wolfram выдал следующий результат:
- a = 124
- d = 71
- e = 72
- f = 100
- i = 83

Наш ключ выглядит так: 124 0 0 71 72 100 0 0 83
Напишем код для дешифровки:
```python
codestr = ''.join(chr(x) for x in [124, 0, 0, 71, 72, 100, 0, 0, 83])


def xorc(a, b):
    return chr(ord(a) ^ ord(b))


def xorstr(a, b):
    return ''.join([xorc(a[(i % len(a))], c) for i, c in enumerate(b)])


print(xorstr(codestr, '\x0fp4$-\x064l?\x06 o!h\x17t3`\x10'))
```
Получимстроку и обернём в mshp{}

### Флаг

**mshp{sp4ceb4llz of st33l}**

## В мире животных.

### Условие 

> *  - Флаг просто строка, не в формате mshp{}
>
> Выводом этой утилиты было... 
> * 32900
> * 33900 
> * 37673 
> * 31649 
> * 35996
>
> Так найди строку, которую ввели!

### Решение 

Если посмотрим код, который находится в crc1.exe через dnspy, то увидим, что там написана кастомная функция для нахождения crc.
Например, мы можем переписать на python это алгоритм и сделать перебор по 3-м символам. Мы получим некоторое количество строк,
которое подходит для заданных нам условий. Так как таск называется "в мире животных", то можем предположить, что нам нудны только слова 
относящиеся к животным и составим следующую строку: cat-32900, dog-33900, fly-37673, and-31649, rat-35996.

код
```
import string
def GETCRC(string):
    num=ord(string[0])
    num2=ord(string[1])
    num3=ord(string[2])
    return (num * num2 + num2 * num3 + num3 * (num + 1) + num * num2 * num3 % 1373)
for i in string.ascii_lowercase:
    for x in string.ascii_lowercase:
        for t in string.ascii_lowercase:
            if GETCRC(i+x+t)==32900 or GETCRC(i+x+t)==33900 or GETCRC(i+x+t)==37673 or GETCRC(i+x+t)==31649 or GETCRC(i+x+t)==35996:
                print(i+x+t, GETCRC(i+x+t)) 
```
вывод кода
```
act 32900
and 31649
art 35996
cat 32900
cum 35996
dog 33900
een 32900
fly 37673
jql 35996
lfy 37673
nad 31649
odg 33900
qjl 35996
rat 35996
ucm 35996
```
### Флаг

**catdogflyandrat**
